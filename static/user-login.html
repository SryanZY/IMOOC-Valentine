<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title></title>
<!-- css文件 放头部-->
<link rel="stylesheet" type="text/css" href="css/style.css" />

<!-- 引入共有的css -->
<script src="js/style.js"></script>
<style>body{background-color:#f6f5f5}</style>
<style>
.container {margin: 10% auto 0 auto} 
#login {margin: 0 auto; width: 500px; min-height: 250px; background-color: #fff; border: 1px solid #dfdfdf; -moz-border-radius:3px; -webkit-border-radius:3px; border-radius:3px; -moz-box-shadow: 0px 1px 15px rgba(0,0,0,0.15); -webkit-box-shadow: 0px 1px 15px rgba(0, 0, 0, 0.15); box-shadow: 0px 1px 15px rgba(0, 0, 0, 0.15)}
#login .panel-head {min-height: 55px; background-color: #409343; border-bottom: 1px solid #dfdfdf; position: relative}
#login .panel-head h4 {margin: 0 0 0 20px; padding: 0; line-height: 55px; font-size: 20px}

#login #submit {min-width: 100px;}
#loginForm {padding: 20px 20px;}
.table-form th, .table-form td {padding: 8px 5px; border-bottom: 0px}
.checkbox {display: inline-block; padding-left: 80px;}

</style>
</head>
<body>

 <div class="container">
  <div id="login">
    <div class="panel-head">
      <h4 id="title"></h4>
    </div>
    <div class="panel-body" id="loginForm">
      <form method="post" target="hiddenwin" class="form-condensed">
        <div id="responser" class="text-center"></div>
        <div class="row">
          <div class="col-xs-4 text-center">
                <i class="icon icon-diamond icon-5x"></i>
          </div>
          <div class="col-xs-8">
            <table class="table table-form">
              <tr>
                <th>用户名</th>
                <td><input type="text" name="userId" id="userId" value="" class="form-control" placeholder="请输入用户名" /></td>
              </tr>
              <tr>
                <th>密码</th>
                <td><input type="password" name="password" id="password" value="" class="form-control" placeholder="请输入密码" /></td>
              </tr>
              <tr>
                <th></th>
                <td>
                   <button type="submit" id="submit" class="btn btn-primary"  data-loading="稍候...">登录</button>
                   <label class="checkbox-inline"><input type="checkbox" name="keepLogin[]" value="on"  id="keepLoginon" /> 记住密码</label>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<br/>
<br/>
<div id="footer" class="text-center"></div>
<!-- js文件放底部 -->
<!-- 共有的js引用commos.js -->
<script src="js/common.js"></script>
<!--  各个页面单独用的js 各自引入-->
<script type="text/javascript">
    $(function() {
        document.title = gz.global.title;
        $('#title').html(gz.global.title);
        $('#header').load('header.html');
        $('#footer').load('footer.html');
        $('#userId').focus();
    });
    
    $('#submit').click(function(){
        var userId = $('#userId').val();
        var password = $('#password').val();
        if(!$.trim(userId) || !$.trim(password)) {
            new $.zui.Messager('用户名或密码为空!!', zuiMessager.fail).show();
            return false;
        }
        
        var expires = {};
        if($('#keepLoginon').is(':checked')){
            //设置cookies保存时间为7天
            var date = new Date();
            date.setTime(date.getTime()+7*24*60*60*1000);
            expires = {expires: date};
        }
        $.ajax({
            contentType: 'application/x-www-form-urlencoded',
            type: "POST",
            data: "userId=" + userId + '&password=' + $.md5($('#password').val()) + '&keepLogin=' + $('#keepLoginon').is(':checked'),
            url: serverUrl +'login',
            dataType: 'json',
            success:function(data, status, xhr){
                if(data.status == '200'){
                    //获取令牌
                    var token = xhr.getResponseHeader('Authorization');
                    //存入cookies
                    $.cookie(cookieTokenKey, token, expires);
                    var user = data.data;
                    $.cookie(cookieUserIdKey, userId, expires);
                    $.cookie(cookieUserRoleKey, user.roleId, expires);
                    $.cookie(cookieSchoolIdKey, user.schoolId, expires);
                    if(user.roleId === Role.Student.key){
                        if(user.lastLoginTime == null){
                            return location.href = 'first-login.html';
                        }else{
                            return location.href = 'user-examlist.html';
                        }
                    } else if(user.roleId === Role.Teacher.key){
                        return location.href = 'clazz.html';
                    } else if(user.roleId === Role.OrgAdmin.key){
                        return location.href = 'user.html';
                    } else if(user.roleId === Role.Admin.key){
                        return location.href = 'school.html';
                    }
                }else{
                    new $.zui.Messager(data.msg, zuiMessager.fail).show();
                }
            },
            error:function(data){
                gz.logger(data);
            }
        });
        return false;
    });
</script>
<script>
// TODO 临时代码 删除
$('#userId').val('100001admin');
$('#password').val('123456');
</script>
</body>
</html>
